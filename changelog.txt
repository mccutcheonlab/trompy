# trompy changelog

## 0.16.0

07/10/2025

### Packaging Modernization
- Added comprehensive `pyproject.toml` with PEP 517/621 compliance
- Eliminated pip deprecation warnings for editable installs (now requires pip >= 21.3)
- Updated Python version support to 3.8-3.12 (dropped 3.4-3.7)
- Made download URLs auto-generate from version (only need to update `_version.py` for releases)
- Package now uses modern setuptools backend (>=64)

### New Feature: remove_longlicks
- Added `remove_longlicks` parameter to `Lickcalc` class and `lickCalc` function
- Allows optional exclusion of long-duration licks from ALL behavioral calculations
- Preserves original data in `licks_raw` and `offset_raw` attributes
- Affects all metrics: bursts, runs, ILIs, frequencies, Weibull parameters, etc.
- Fully tested with 5 new test cases
- 100% backward compatible (disabled by default)
- Documentation: `docs/REMOVE_LONGLICKS.md` and `examples/remove_longlicks_example.py`

### Code Optimizations (lickcalc.py and lick_utils.py)
- Simplified parameter initialization using `.get()` with defaults (32 lines → 8 lines)
- Fixed `get_burst_mean()` logic error (now correctly slices first N bursts)
- Optimized filtering operations with numpy boolean indexing (2-10x faster for large datasets)
- Optimized `_get_corresponding_offsets()` from O(n²) to O(n) using numpy operations (10-1000x faster)
- Removed unnecessary type conversions and list comprehensions
- Applied PEP 8 best practices (use `is None` instead of `== None`)
- Overall performance improvement: 10-20% for small datasets, 5-10x for large datasets

### Bug Fixes
- Fixed integer indexing bug in `get_burst_end()` method
- Removed debug print statements from `lickcalc.py` and `lick_utils.py`
- Removed `if __name__ == '__main__'` test blocks

### Documentation
- Added `OPTIMIZATIONS.md` - detailed performance improvements
- Added `REMOVE_LONGLICKS.md` - comprehensive user guide for new feature
- Added `PACKAGING_MODERNIZATION.md` - packaging migration notes
- Added `SETUP_PY_REMOVAL_GUIDE.md` - guidance on modern Python packaging
- Added `RELEASE_CHECKLIST.md` - simplified release workflow
- Added `REMOVE_LONGLICKS_IMPLEMENTATION.md` - technical implementation details

## 0.15.8

04/10/2025

- Bumped package version to 0.15.8
- Made package imports lazy: `trompy/__init__.py` now lazy-loads submodules on first access to reduce import cost and optional dependency requirements
- Single source of truth for version: added `trompy/_version.py` and updated `setup.py` to read the version without importing the package
- Improved test setup: added `tests/conftest.py` to force a non-interactive matplotlib backend, isolate NumPy RNG per test, and provide a test-only `audioop` shim for CI/local testing; removed test shim from the repo root
- Updated `usefulinfo.txt` with an explicit PowerShell release workflow and updated `setup.py` download_url

## 0.15.7

04/10/2025

- Added new time division function to lickcalc

## 0.15.6

11/04/2024

- Fixed bug in lickCalc when making lick runs

## 0.15.5

10/04/2024

- Updated snipper function with better baseline options

## 0.15.4

26/02/2024

- Rewrote lickcalc function to use class definition
-- Included option for minimum run length

## 0.15.3

23/02/2024

- Added function to calculate least significant difference posthocs

## 0.15.2

22/02/2024

- Updated medfile reader
-- Now accepts uppercase letters for variables
-- More Pythonic argument names (old arguments still work)
-- Fixed bug when all variables were extracted
-- Allows output as dictionary with keys as variable names (letters)

- Fixed bug in lickCalc causing some bursts not to be counted if too early in session

## 0.15.1

21/02/2024

- Updated metafilereader to accept .xls and .xlsx files (included test script)
- Removed metafilemaker as has not been required for a while

## 0.15.0

06/12/2022

- Major update with changes to barscatter, shadedError, snipper
- Removed GUIs from package

## 0.14.0

20/03/2022

- Added function to merge FED files
- Added additional documentation as docstrings preparing for upload to readthedocs

## 0.13.7

27/01/2022

- Fixed issues with processdata, added zscore option

## 0.13.6

21/01/2022

- Added download_data function to general_utils

## 0.13.5

04/01/2022

- Added find_overlap function to general_utils

## 0.13.4

12/07/2021

- Added reverse signals option to photogui_np

## 0.13.3

06/07/2021

- Fixed linewidth bug in barscatter

## 0.13.2

05/07/2021

- Added normalization options to processdata
- Added description of 'unequal' option to barscatter
- Updated barscatter to allow changes to linewidth

## 0.13.1

28/06/2021

- Fixed bug in processdata (correction to Lerner method)
- Fixed issue #2 in photoguis for saving files

## 0.13.0

08/06/2021

- Added neurophotometrics GUI (alpha version)

31/03/2021

## 0.12.6

31/03/2021

- Updated snipper so that it can cope with non-numeric values (e.g. nans or infinites) by removal
- Updated photo_gui so that bits are read from Port A and Port B when included in TDT file

## 0.12.5

02/03/2021

- Updated lickCalc to cope with onset and offset arrays of different lengths

## 0.12.4

24/02/2021

- Updated metafilereader to read directly from Excel files.

## 0.12.3

29/01/2021

- Changed barscatter so scatters were not clipped
- Fixed bug in medfilereader by adding datetime import

## 0.12.2

19/06/20

- Added keyboard shortcut (n) to toggle noise

## 0.12.1

19/06/20

- Fixed bug in makeExcel function
- Added event times to Excel output

## 0.12.0

02/06/20

- Made improvements to photogui based on feedback including terminal output

## 0.11.4

14/05/20

- Fixed import errors in lick_gui and roc_utils

## 0.11.3

14/05/20

- Fixed syntax error in __init__.py

## 0.11.2

14/05/20

- Moved medfilereader associated fx from lick_gui to medfilereader
- Added ROC fx to roc_utils

## 0.11.1

14/05/20

- Fixed import bug in __init__.py

## 0.11.0

14/05/20

- Updated init file so internal functions are not imported
- Added warnings when matplotlib backend conflicts with one that is already loaded
- Updated barscatter to fix bug on x axis

## 0.9.2 / 0.10.0 (Conflict with names on Github - 0.9.02 - and PyPi - 0.10.0)

27/04/20

- Added quickstart tips to photogui

## 0.9.1

26/04/20

- Changed method of producing lick runs by adding to onset and offset menu
- Added ability to generate random events
- Added ability to extract events from 'notes'

## 0.9.0

24/04/20

- Added additional labels to photo_gui and made snipper utility more flexible
- Added workaround to allow streams beginning with underscores to be read in.
- Changed snipper_utils extensively, making mastersnipper and snipper more flexible
- Removed need for t2sMap from most snipper functions

## 0.8.2

21/04/20

- Fixed typo in __init__.py (trompy.roc_utils instead of roc_utils)

## 0.8.1

21/04/20

- Updated to include README description on PyPi be changing setup.py

## 0.8.0

21/04/20

- Updated save paths for exporting from GUIs - using pathlib for Mac/Linux compatibility
- Added ROC utilities
- Added additional files for pypi documentation (e.g. README.rst, MANIFEST.in, changelog.txt)
- Added documentation folders and files using Sphinx (in process)
- Made minor change to barscatter (replaced plt. with ax. in code that makes legend)
